%% layer_init and query flow diagram
%% Version: v1.1.0
%% Last updated: 2025-10-09
flowchart LR
    layer_init[(layer_init<br/>layers map)] --> Cortex
    layer_init --> Emotional
    layer_init --> Mental
    layer_init --> Spiritual
    layer_init --> Narrative
    layer_init --> Diagnostics[[diagnostics<br/>failed_attempts · fallbacks]]
    Diagnostics --> StageB[Stage B gauges]

    Query[query_memory] --> Cortex
    Query --> Emotional
    Query --> Mental
    Query --> Spiritual
    Query --> Narrative

    Cortex --> Aggregate
    Emotional --> Aggregate
    Mental --> Aggregate
    Spiritual --> Aggregate
    Narrative --> Aggregate

    Aggregate --> StatusMap[Status map + failed_layers]
    Aggregate --> QueryDiagnostics[[bundle.diagnostics cache]]
    StatusMap --> OperatorAgent[Operator Agent]
