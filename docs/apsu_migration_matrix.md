# APSU Migration Matrix

This matrix consolidates the status of legacy APSU entry points and their Neo-APSU counterparts. Each row lists the legacy module, the Rust crate or PyO3 bridge replacing it, the current migration state, and known defects recorded in readiness packets or doctrine logs. The machine-readable representation lives in `component_index.json` under `apsu_migration`.

| Legacy Entry Point | Prototype / Fixture References | Status | Neo-APSU Replacement | Known Defects | Sandbox vs Hardware Notes |
| --- | --- | --- | --- | --- | --- |
| <a id="crown_router"></a>`crown_router` | [NEOABZU/crown/src/lib.rs](../NEOABZU/crown/src/lib.rs), [tests/crown/test_router_memory.py](../tests/crown/test_router_memory.py) | Ready – status `ported` in registry, executing the Rust router path.【F:component_index.json†L4-L12】 | `neoabzu_crown::route_decision` and related PyO3 exports for routing and expression selection.【F:NEOABZU/crown/src/lib.rs†L48-L159】 | None recorded after Stage G parity run; ledger signed off by gate owners.【F:logs/stage_g/20251102T090000Z-stage_g_gate_runner_hardware/approvals.yaml†L1-L12】 | Stage G hardware bundle keeps parity hashes aligned; continue routine parity verification during gate-runner replays.【F:logs/stage_g/20251102T090000Z-stage_g_gate_runner_hardware/summary.json†L1-L13】 |
| <a id="identity_loader_py"></a>`identity_loader.py` | [tests/apsu_migration/test_identity_loader_parity.py](../tests/apsu_migration/test_identity_loader_parity.py), [init_crown_agent.py](../init_crown_agent.py) | Ready – status `ported`; sandbox boots run the PyO3 loader with fingerprint telemetry.【F:component_index.json†L13-L21】【F:init_crown_agent.py†L21-L44】 | `neoabzu_crown::load_identity` handles identity synthesis during boot.【F:component_index.json†L13-L17】 | No open defects; parity checks recorded alongside fingerprint hashes.【F:logs/stage_g/20251102T094500Z-stage_g_neo_apsu_parity/approvals.yaml†L1-L12】 | Hardware approvals confirm ledger lineage; monitor Stage G/H replays for drift in fingerprint metrics.【F:logs/stage_g/20251102T094500Z-stage_g_neo_apsu_parity/summary.json†L1-L13】 |
| <a id="crown_decider_py"></a>`crown_decider.py` | [scripts/_stage_runtime.py](../scripts/_stage_runtime.py#L188-L244), [tests/crown/test_decider.py](../tests/crown/test_decider.py) | In progress – registry marks `pending_rewrite`; sandbox relies on deterministic stub while Rust path is wired.【F:component_index.json†L22-L32】【F:scripts/_stage_runtime.py†L188-L244】 | `neoabzu_crown::route_decision` implements the Rust decider exposed through PyO3.【F:NEOABZU/crown/src/lib.rs†L86-L159】 | Sandbox stub hides real MoGE telemetry; validator gating deferred to hardware replay.【F:docs/PROJECT_STATUS.md†L180-L187】 | Stage F hardware run must replace the stub with the Rust bridge using Stage B rotation evidence before sign-off.【F:docs/stage_f_hardware_replay_plan.md†L11-L21】 |
| <a id="crown_prompt_orchestrator_py"></a>`crown_prompt_orchestrator.py` | [scripts/_stage_runtime.py](../scripts/_stage_runtime.py#L188-L244), [tests/crown/test_prompt_orchestrator.py](../tests/crown/test_prompt_orchestrator.py) | In progress – registry entry `pending_rewrite`; async orchestrator remains stubbed during sandbox rehearsals.【F:component_index.json†L33-L43】【F:scripts/_stage_runtime.py†L188-L244】 | `neoabzu_rag::MoGEOrchestrator` provides the Rust retrieval pipeline.【F:NEOABZU/crown/src/lib.rs†L95-L128】 | Mission retrieval parity dashboards stay incomplete while the stub short-circuits orchestration.【F:docs/PROJECT_STATUS.md†L182-L187】 | Stage F replays schedule Rust orchestrator validation using recorded Stage C/E handshake diffs when hardware returns.【F:docs/stage_f_hardware_replay_plan.md†L17-L25】 |
| <a id="state_transition_engine_py"></a>`state_transition_engine.py` | [scripts/_stage_runtime.py](../scripts/_stage_runtime.py#L188-L244), [tests/test_state_transition_engine.py](../tests/test_state_transition_engine.py) | In progress – `pending_rewrite`; sandbox provides deterministic rotation without Rust diagnostics.【F:component_index.json†L44-L54】【F:scripts/_stage_runtime.py†L188-L244】 | `neoabzu_crown::route_inevitability` emits inevitability traces once Rust path activates.【F:component_index.json†L44-L48】 | Rust spans absent from readiness packets; ritual journey metrics still synthetic.【F:docs/PROJECT_STATUS.md†L182-L187】 | Gate-runner hardware run must emit Rust spans per Stage F replay plan before migration closes.【F:docs/stage_f_hardware_replay_plan.md†L25-L33】 |
| <a id="servant_model_manager_py"></a>`servant_model_manager.py` | [scripts/_stage_runtime.py](../scripts/_stage_runtime.py#L188-L244), [tests/test_servant_model_manager.py](../tests/test_servant_model_manager.py) | In progress – `pending_rewrite`; sandbox registry stub hides servant telemetry and metrics.【F:component_index.json†L55-L65】【F:scripts/_stage_runtime.py†L736-L833】 | Neo-APSU servant bridge inside `neoabzu_crown` will own servant lifecycle when port completes.【F:component_index.json†L55-L61】 | Telemetry gaps leave servant contract metrics deferred in readiness bundles.【F:docs/PROJECT_STATUS.md†L182-L187】 | Hardware replays should activate the Rust-managed registry to capture servant lifecycle metrics before promotion.【F:docs/stage_f_hardware_replay_plan.md†L21-L29】 |
| <a id="emotional_state_py"></a>`emotional_state.py` | [scripts/_stage_runtime.py](../scripts/_stage_runtime.py#L188-L244), [tests/test_emotion_state.py](../tests/test_emotion_state.py) | In progress – `pending_rewrite`; sandbox shim maintains in-memory aura persistence only.【F:component_index.json†L66-L76】【F:scripts/_stage_runtime.py†L697-L733】 | Neo-APSU crown expression pipeline will publish aura telemetry once Rust codepath is live.【F:component_index.json†L66-L70】 | Aura telemetry remains synthetic, blocking hardware-ready dashboards.【F:docs/PROJECT_STATUS.md†L182-L187】 | Stage F window validates Rust expression telemetry against live sensors when hardware access resumes.【F:docs/stage_f_hardware_replay_plan.md†L33-L41】 |
| <a id="memory_store_py"></a>`memory_store.py` | [scripts/_stage_runtime.py](../scripts/_stage_runtime.py#L215-L233), [tests/test_memory_store.py](../tests/test_memory_store.py) | Hardware validation pending – registry `wrapped`; sandbox uses optional bundle shim when Rust library missing.【F:component_index.json†L77-L87】【F:scripts/_stage_runtime.py†L215-L233】 | `neoabzu_memory::MemoryBundle` exposes native persistence across layers.【F:component_index.json†L77-L81】 | Readiness packets log `cortex layer empty` when shim engaged; checksums deferred.【F:docs/PROJECT_STATUS.md†L186-L187】 | Stage F parity run rebuilds the Rust bundle on hardware to confirm checksum parity before promotion.【F:docs/stage_f_hardware_replay_plan.md†L33-L39】 |
| <a id="connectors_operator_mcp_adapter_py"></a>`connectors/operator_mcp_adapter.py` | [tests/test_operator_transport_contract.py](../tests/test_operator_transport_contract.py), [tests/scripts/test_stage_b_smoke.py](../tests/scripts/test_stage_b_smoke.py) | Hardware validation pending – registry `wrapped`; sandbox captures REST↔gRPC parity but omits heartbeat latency metrics.【F:component_index.json†L88-L98】【F:tests/test_operator_transport_contract.py†L14-L176】 | REST↔gRPC transport pairing via `operator_api`/`operator_api_grpc` modules.【F:component_index.json†L88-L92】 | Heartbeat telemetry deferred until credentials unlock hardware probes; environment-limited flag persists.【F:docs/PROJECT_STATUS.md†L174-L205】 | Stage F/H hardware replays must capture heartbeat payloads and latency spans alongside sandbox traces before sign-off.【F:docs/stage_f_hardware_replay_plan.md†L39-L47】 |

## Usage

- Update this table and the `apsu_migration` array whenever migration status changes, including defect references, readiness evidence, and links to prototypes or stubs.
- Contract tests for ported rows live under `tests/apsu_migration/` to compare legacy Python behavior with PyO3 shims in a sandbox-safe manner.

## Related Artifacts

- [Migration Crosswalk](../NEOABZU/docs/migration_crosswalk.md)
- [System Blueprint](system_blueprint.md)
- [Project Status – Stage D backlog](PROJECT_STATUS.md#stage-d-bridge-snapshot)
