{
  "status": "success",
  "stage": "stage_b3_connector_rotation",
  "run_id": "20251001T080910Z-stage_b3_connector_rotation",
  "command": [
    "/root/.pyenv/versions/3.12.10/bin/python",
    "/workspace/ABZU/scripts/stage_b_smoke.py",
    "--json"
  ],
  "returncode": 0,
  "error": null,
  "started_at": "2025-10-01T08:09:10.056509+00:00",
  "completed_at": "2025-10-01T08:09:23.643358+00:00",
  "duration_seconds": 13.586849,
  "log_dir": "/workspace/ABZU/logs/stage_b/20251001T080910Z-stage_b3_connector_rotation",
  "stdout_path": "/workspace/ABZU/logs/stage_b/20251001T080910Z-stage_b3_connector_rotation/stage_b3_connector_rotation.stdout.log",
  "stderr_path": "/workspace/ABZU/logs/stage_b/20251001T080910Z-stage_b3_connector_rotation/stage_b3_connector_rotation.stderr.log",
  "stdout_lines": 1192,
  "stderr_lines": 18,
  "stdout_tail": [
    "          },",
    "          \"recorded_at\": \"2025-10-01T08:09:21.662415+00:00\",",
    "          \"mode\": \"trial\"",
    "        }",
    "      }",
    "    }",
    "  },",
    "  \"doctrine_ok\": true,",
    "  \"doctrine_failures\": []",
    "}"
  ],
  "stderr_tail": [
    "/root/.pyenv/versions/3.12.10/lib/python3.12/site-packages/torch/nn/modules/transformer.py:392: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.self_attn.batch_first was not True(use batch_first for better inference performance)",
    "  warnings.warn(",
    "/workspace/ABZU/scripts/_stage_runtime.py:337: EnvironmentLimitedWarning: environment-limited: activated sandbox stub for 'neoabzu_memory' (neoabzu_memory: optional bundle shim activated)",
    "  _prepare_overrides()",
    "/workspace/ABZU/scripts/_stage_runtime.py:337: EnvironmentLimitedWarning: environment-limited: activated sandbox stub for 'servant_model_manager' (servant_model_manager: local registry only)",
    "  _prepare_overrides()",
    "/workspace/ABZU/scripts/_stage_runtime.py:337: EnvironmentLimitedWarning: environment-limited: activated sandbox stub for 'state_transition_engine' (state_transition_engine: deterministic rotation)",
    "  _prepare_overrides()",
    "/workspace/ABZU/scripts/_stage_runtime.py:337: EnvironmentLimitedWarning: environment-limited: activated sandbox stub for 'INANNA_AI.glm_integration' (glm_integration: remote health check bypassed)",
    "  _prepare_overrides()"
  ],
  "targets": [
    "operator_api",
    "operator_upload",
    "crown_handshake"
  ],
  "rotation_ledger_snapshot": {
    "operator_api": {
      "connector_id": "operator_api",
      "rotated_at": "2025-09-26T22:28:14Z",
      "window_hours": 48,
      "rotation_window": {
        "window_id": "20250926T222814Z-PT48H",
        "started_at": "2025-09-26T22:28:14Z",
        "expires_at": "2025-09-28T22:28:14Z",
        "duration": "PT48H"
      },
      "credential_window": {
        "issued_at": "2025-09-26T22:28:14Z",
        "expires_at": "2025-09-28T22:28:14Z",
        "duration": "P2D",
        "rotation_window_id": "20250926T222814Z-PT48H"
      },
      "context_status": {
        "stage-b-rehearsal": {
          "status": "accepted",
          "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
          "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
          "accepted_via": "stage_c4_operator_mcp_drill"
        },
        "stage-c-prep": {
          "status": "accepted",
          "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
          "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
          "accepted_via": "stage_c4_operator_mcp_drill"
        }
      },
      "traces": {
        "rest": {
          "method": "POST",
          "endpoint": "http://localhost:8001/handshake",
          "request": {
            "identity": {
              "connector_id": "operator_api",
              "version": "0.1.0",
              "instance": "local"
            },
            "supported_contexts": [
              {
                "name": "stage-b-rehearsal",
                "channels": [
                  "handshake",
                  "heartbeat",
                  "command"
                ],
                "capabilities": [
                  "register",
                  "telemetry",
                  "command"
                ]
              }
            ],
            "rotation": {
              "last_rotated": "2025-10-01T08:09:21Z",
              "rotation_window": "PT48H",
              "supports_hot_swap": true,
              "token_hint": "operator"
            }
          },
          "response": {
            "authenticated": true,
            "session": {
              "id": "stage-c-session",
              "credential_expiry": "2025-09-28T22:28:14Z"
            },
            "accepted_contexts": [
              {
                "name": "stage-b-rehearsal",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
                "accepted_via": "stage_c4_operator_mcp_drill"
              },
              {
                "name": "stage-c-prep",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
                "accepted_via": "stage_c4_operator_mcp_drill"
              }
            ],
            "rotation": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "echo": {
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              }
            }
          },
          "normalized": {
            "authenticated": true,
            "session": {
              "id": "stage-c-session",
              "credential_expiry": "2025-09-28T22:28:14Z"
            },
            "accepted_contexts": [
              {
                "name": "stage-b-rehearsal",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
              },
              {
                "name": "stage-c-prep",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
              }
            ],
            "rotation": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "echo": {
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              }
            }
          },
          "checksum": "30b2c06c4b4ffeb5d403c63fb7a4ee283f9f8f109b3484876fe09d7ec6de56c8"
        },
        "grpc": {
          "service": "neoabzu.vector.VectorService",
          "method": "Init",
          "rpc": "neoabzu.vector.VectorService/Init",
          "request": {
            "stage": "B",
            "connector_id": "operator_api",
            "contexts": [
              "stage-b-rehearsal",
              "stage-c-prep"
            ]
          },
          "response": {
            "message": "trial handshake parity for operator_api",
            "handshake_equivalent": {
              "authenticated": true,
              "session": {
                "id": "stage-c-session",
                "credential_expiry": "2025-09-28T22:28:14Z"
              },
              "accepted_contexts": [
                {
                  "name": "stage-b-rehearsal",
                  "status": "accepted",
                  "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                  "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
                },
                {
                  "name": "stage-c-prep",
                  "status": "accepted",
                  "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                  "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
                }
              ],
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              },
              "echo": {
                "rotation": {
                  "connector_id": "operator_api",
                  "last_rotated": "2025-09-26T22:28:14Z",
                  "rotation_window": "PT48H",
                  "window_id": "20250926T222814Z-PT48H"
                }
              }
            }
          },
          "metadata": {
            "parity_checksum": "30b2c06c4b4ffeb5d403c63fb7a4ee283f9f8f109b3484876fe09d7ec6de56c8",
            "credential_expiry": "2025-09-28T22:28:14Z",
            "rotation_window": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "recorded_at": "2025-10-01T08:09:21.660133+00:00",
            "mode": "trial"
          }
        }
      }
    },
    "operator_upload": {
      "connector_id": "operator_upload",
      "rotated_at": "2025-09-26T22:28:14Z",
      "window_hours": 48,
      "rotation_window": {
        "window_id": "20250926T222814Z-PT48H",
        "started_at": "2025-09-26T22:28:14Z",
        "expires_at": "2025-09-28T22:28:14Z",
        "duration": "PT48H"
      },
      "credential_window": {
        "issued_at": "2025-09-26T22:28:14Z",
        "expires_at": "2025-09-28T22:28:14Z",
        "duration": "P2D",
        "rotation_window_id": "20250926T222814Z-PT48H"
      },
      "traces": {
        "rest": {
          "method": "POST",
          "endpoint": "http://localhost:8001/handshake",
          "request": {
            "identity": {
              "connector_id": "operator_upload",
              "version": "0.1.0",
              "instance": "local"
            },
            "supported_contexts": [
              {
                "name": "stage-b-rehearsal",
                "channels": [
                  "handshake",
                  "heartbeat",
                  "upload"
                ],
                "capabilities": [
                  "register",
                  "telemetry",
                  "upload"
                ]
              }
            ],
            "rotation": {
              "last_rotated": "2025-10-01T08:09:21Z",
              "rotation_window": "PT48H",
              "supports_hot_swap": true,
              "token_hint": "operator-upload"
            }
          },
          "response": {
            "authenticated": true,
            "session": {
              "id": "stage-c-session",
              "credential_expiry": "2025-09-28T22:28:14Z"
            },
            "accepted_contexts": [
              {
                "name": "stage-b-rehearsal",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
                "accepted_via": "stage_c4_operator_mcp_drill"
              },
              {
                "name": "stage-c-prep",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
                "accepted_via": "stage_c4_operator_mcp_drill"
              }
            ],
            "rotation": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "echo": {
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              }
            }
          },
          "normalized": {
            "authenticated": true,
            "session": {
              "id": "stage-c-session",
              "credential_expiry": "2025-09-28T22:28:14Z"
            },
            "accepted_contexts": [
              {
                "name": "stage-b-rehearsal",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
              },
              {
                "name": "stage-c-prep",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
              }
            ],
            "rotation": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "echo": {
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              }
            }
          },
          "checksum": "30b2c06c4b4ffeb5d403c63fb7a4ee283f9f8f109b3484876fe09d7ec6de56c8"
        },
        "grpc": {
          "service": "neoabzu.vector.VectorService",
          "method": "Init",
          "rpc": "neoabzu.vector.VectorService/Init",
          "request": {
            "stage": "B",
            "connector_id": "operator_upload",
            "contexts": [
              "stage-b-rehearsal",
              "stage-c-prep"
            ]
          },
          "response": {
            "message": "trial handshake parity for operator_upload",
            "handshake_equivalent": {
              "authenticated": true,
              "session": {
                "id": "stage-c-session",
                "credential_expiry": "2025-09-28T22:28:14Z"
              },
              "accepted_contexts": [
                {
                  "name": "stage-b-rehearsal",
                  "status": "accepted",
                  "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                  "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
                },
                {
                  "name": "stage-c-prep",
                  "status": "accepted",
                  "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                  "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
                }
              ],
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              },
              "echo": {
                "rotation": {
                  "connector_id": "operator_api",
                  "last_rotated": "2025-09-26T22:28:14Z",
                  "rotation_window": "PT48H",
                  "window_id": "20250926T222814Z-PT48H"
                }
              }
            }
          },
          "metadata": {
            "parity_checksum": "30b2c06c4b4ffeb5d403c63fb7a4ee283f9f8f109b3484876fe09d7ec6de56c8",
            "credential_expiry": "2025-09-28T22:28:14Z",
            "rotation_window": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "recorded_at": "2025-10-01T08:09:21.661711+00:00",
            "mode": "trial"
          }
        }
      }
    },
    "crown_handshake": {
      "connector_id": "crown_handshake",
      "rotated_at": "2025-09-26T22:28:14Z",
      "window_hours": 48,
      "rotation_window": {
        "window_id": "20250926T222814Z-PT48H",
        "started_at": "2025-09-26T22:28:14Z",
        "expires_at": "2025-09-28T22:28:14Z",
        "duration": "PT48H"
      },
      "credential_window": {
        "issued_at": "2025-09-26T22:28:14Z",
        "expires_at": "2025-09-28T22:28:14Z",
        "duration": "P2D",
        "rotation_window_id": "20250926T222814Z-PT48H"
      },
      "traces": {
        "rest": {
          "method": "POST",
          "endpoint": "http://localhost:8001/handshake",
          "request": {
            "identity": {
              "connector_id": "crown_handshake",
              "version": "0.1.0",
              "instance": "local"
            },
            "supported_contexts": [
              {
                "name": "stage-b-rehearsal",
                "channels": [
                  "handshake",
                  "heartbeat",
                  "mission-brief"
                ],
                "capabilities": [
                  "register",
                  "telemetry",
                  "mission-brief"
                ]
              }
            ],
            "rotation": {
              "last_rotated": "2025-10-01T08:09:21Z",
              "rotation_window": "PT48H",
              "supports_hot_swap": true,
              "token_hint": "crown"
            }
          },
          "response": {
            "authenticated": true,
            "session": {
              "id": "stage-c-session",
              "credential_expiry": "2025-09-28T22:28:14Z"
            },
            "accepted_contexts": [
              {
                "name": "stage-b-rehearsal",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
                "accepted_via": "stage_c4_operator_mcp_drill"
              },
              {
                "name": "stage-c-prep",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
                "accepted_via": "stage_c4_operator_mcp_drill"
              }
            ],
            "rotation": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "echo": {
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              }
            }
          },
          "normalized": {
            "authenticated": true,
            "session": {
              "id": "stage-c-session",
              "credential_expiry": "2025-09-28T22:28:14Z"
            },
            "accepted_contexts": [
              {
                "name": "stage-b-rehearsal",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
              },
              {
                "name": "stage-c-prep",
                "status": "accepted",
                "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
              }
            ],
            "rotation": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "echo": {
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              }
            }
          },
          "checksum": "30b2c06c4b4ffeb5d403c63fb7a4ee283f9f8f109b3484876fe09d7ec6de56c8"
        },
        "grpc": {
          "service": "neoabzu.vector.VectorService",
          "method": "Init",
          "rpc": "neoabzu.vector.VectorService/Init",
          "request": {
            "stage": "B",
            "connector_id": "crown_handshake",
            "contexts": [
              "stage-b-rehearsal",
              "stage-c-prep"
            ]
          },
          "response": {
            "message": "trial handshake parity for crown_handshake",
            "handshake_equivalent": {
              "authenticated": true,
              "session": {
                "id": "stage-c-session",
                "credential_expiry": "2025-09-28T22:28:14Z"
              },
              "accepted_contexts": [
                {
                  "name": "stage-b-rehearsal",
                  "status": "accepted",
                  "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                  "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
                },
                {
                  "name": "stage-c-prep",
                  "status": "accepted",
                  "evidence_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
                  "summary_path": "/workspace/ABZU/logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json"
                }
              ],
              "rotation": {
                "connector_id": "operator_api",
                "last_rotated": "2025-09-26T22:28:14Z",
                "rotation_window": "PT48H",
                "window_id": "20250926T222814Z-PT48H"
              },
              "echo": {
                "rotation": {
                  "connector_id": "operator_api",
                  "last_rotated": "2025-09-26T22:28:14Z",
                  "rotation_window": "PT48H",
                  "window_id": "20250926T222814Z-PT48H"
                }
              }
            }
          },
          "metadata": {
            "parity_checksum": "30b2c06c4b4ffeb5d403c63fb7a4ee283f9f8f109b3484876fe09d7ec6de56c8",
            "credential_expiry": "2025-09-28T22:28:14Z",
            "rotation_window": {
              "connector_id": "operator_api",
              "last_rotated": "2025-09-26T22:28:14Z",
              "rotation_window": "PT48H",
              "window_id": "20250926T222814Z-PT48H"
            },
            "recorded_at": "2025-10-01T08:09:21.662415+00:00",
            "mode": "trial"
          }
        }
      }
    }
  },
  "stage_c_summary_path": "logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/summary.json",
  "stage_c_handshake_path": "logs/stage_c/20250926T222813Z-stage_c4_operator_mcp_drill/mcp_handshake.json",
  "rotation_window_hours": 48
}